{% extends 'videos/base.html' %}
{% block private-css-bottom %}
<style>
    #iplause {
        color: transparent;
    }
</style>
{% endblock %}
{% block private-js %}
<script>
    var audio = document.getElementById("video_");
        function plause() {
            if(audio.paused)
            {
                $('#iplause').removeClass('glyphicon-play');
                $('#iplause').addClass('glyphicon-pause');
                audio.play();
            }
            else if(audio.play)
            {
                $('#iplause').removeClass('glyphicon-pause');
                $('#iplause').addClass('glyphicon-play');
                audio.pause();
            }
        }

        function reply(id) {
            $("#comment"+id).toggle();
        }

        $(document).ready(function() {
            console.log('ghhgd');
            for (var i = 0; i < 10; i++) {
                $("#comments").html("" +
                       "<div style='margin-bottom:-20px;'>"+
                            "<a href=' pro ' style='font-size:17px; font-weight:700'>{{comment.added_by.username}}</a>"+
                            "<span>" + data[i].fields.text + "</span>"+



                            "<p><small class='text-muted'><span style='letter-spacing:-2px'>{{ comment.date_added|timesince|stringformat:'.3s'|cut:' ' }}</span> {% if comment.heart_set.all.count > 0 %}<span class='small-space'>{{comment.heart_set.all.count}} hearts</span>{% endif %} {% if comment.reply_set.all.count > 0 %}<span class='small-space'>{{comment.reply_set.all.count}} replies</span>{% endif %}<a onclick='reply({{comment.id}})' class='small-space text-muted'>Reply</a></small></p>"+
                            "<div style='padding-left: 30px; margin-top: -20px;'><hr>"+

                                "<form class='form-inline' id='comment{{comment.id}}' method='post' action='create_reply' hidden>{% csrf_token %}"+
                                    "<div class='form-group'><input type='text' name='text' class='form-control' id='reply{{comment.id}}' placeholder='reply'><button type='submit' class='btn btn-default'>reply</button></div>"+
                                "</form>"+
                            "</div>"+
                        "</div>"+
                        "<hr>");
                        }
        });

       $("#comment").submit(function(e) {
        e.preventDefault();
          var text = document.getElementById("comment").elements[1].value;
          var token = document.getElementById("comment").elements[0].value;
          id = {{video.id}}
          console.log(token)
          $.ajax({
          type : 'POST',
            url: '/videos/create_comment/',
            data: {
              text: text,
              id:id,
              csrfmiddlewaretoken: token
            },
            success: function (data) {
            data= data;
            console.log(data);
                    $("#text").html(data.lenght());
                    for (var i = 0; i < 10; i++) {  console.log(data[i].fields.text ); }
                $("#sux").html("Success"+data);
            },
            error: function (data) {
                if (data.is_taken) {
                    $("#sux-text").html("Your email already exists");
                  }
                $("#sux").html("Error!.");
                $("#sux-text").html("An error occur make sure your email is typed correctly!.");
                $("#ajax-notification").addClass("alert-danger");
                $("#ajax-notification").fadeOut(10000);
                    alert(data);
                    console.log(data)
            }
          });

        });

</script>
{% endblock %}
{% block body%}
<div class="row row-offcanvas row-offcanvas-right">
    <div class="col-xs-12 col-sm-9">
        <p class="pull-right visible-xs">
            <button type="button" class="btn btn-primary btn-xs" data-toggle="offcanvas">Toggle nav</button>
        </p>
        <div class="jumbotron" style="padding-bottom:2px; border-radius: 0;">
            <div class="bs-example" data-example-id="responsive-embed-16by9-iframe-youtube" style="margin: -20px -58px; margin-top: -46px;">
                <div class="embed-responsive embed-responsive-16by9" style="background-color:#131212">
                    <video id="video_" controls autoplay>
                        <source src="{{ video.path.url}}" type="video/mp4">
                        <source src="{{'/media/Stupid_questions.mp4'}}" type="video/ogg">
                        Your browser does not support the video tag.
                    </video>
                </div>
                <button onclick="plause()" style="margin-top: -560px; margin-left: 44%;" class="btn btn-default btn-lg" type="button"><h1 id="iplause" class="glyphicon glyphicon-play" ></h1></button>
                <h5 style="padding-top: 0; padding-bottom: 15px; margin-top: -10px;" >
                    <span>{{video.name}}</span>
                    <span class="pull-right"> {{video.view_count}} views</span>
                    {% if is_dislike > 0 %}
                        <span class="glyphicon glyphicon-thumbs-down small-space pull-right" style="color:#4285f4; font-weight:bolder;  top:-4px; font-size:18px">{{video.dislike_set.all.count}}</span>
                    {% else %}
                    <form method="post" class="small-space pull-right" action="{% url 'videos:create_dislike' pk=video.pk %}">{% csrf_token %}
                        <button type="submit" class="glyphicon glyphicon-thumbs-down btn-link" style="color:#333; top:-4px; font-size:18px">{{video.dislike_set.all.count}}</button>
                    </form>
                    {% endif %}

                    {% if is_like > 0 %}
                        <span class="pull-right " style="color:#6f6f6f; font-weight:bolder;  top:-4px; font-size:18px">{{video.like_set.all.count}}</span>
                        <span class="glyphicon glyphicon-thumbs-up pull-right" style="color:#5cb85c; font-weight:bolder;  top:-4px; font-size:18px"></span>
                    {% else %}
                    <form method="post" class="small-space pull-right" action="{% url 'videos:create_like' pk=video.pk %}">{% csrf_token %}
                        <button type="submit" class="glyphicon glyphicon-thumbs-up small-space btn-link" style="color:#333; top:-4px; font-size:18px">{{video.like_set.all.count}}</button>
                    </form>
                    {% endif %}

                </h5>
            </div>
        </div>
        <div class="row">
            <div class="col-xs-6 col-lg-8"><h2>Comment</h2>
                <!--<form class="form-horizontal" method="post" action="{% url 'videos:create_comment' pk=video.pk %}">{% csrf_token %}-->
                    <!--<div class="row">-->
                        <!--<div class="col-md-11" style="padding-right: 0px;"><input type="text" name="text" class="form-control pull-right" placeholder="Comment"></div>-->
                        <!--<div class="col-md-1" style="padding: 0px;"><button style="padding-bottom: 7px;" type="submit" class="btn btn-success pull-right">Post</button></div>-->
                    <!--</div>-->
                <!--</form><br>-->
                <form id="comment" class="form-horizontal" method="post">{% csrf_token %}
                    <div class="row">
                        <div class="col-md-11" style="padding-right: 0px;"><input type="text" name="text" class="form-control pull-right" placeholder="Comment"></div>
                        <div class="col-md-1" style="padding: 0px;"><button style="padding-bottom: 7px;" type="submit" class="btn btn-success pull-right">Post</button></div>
                    </div>
                </form><br>


                    <div id="comments">

                    </div>

                {% for comment in video.comment_set.all %}
                    <div style="margin-bottom:-20px;">
                        <a href="{% url 'accounts:profile' pk=comment.added_by.id %}" style="font-size:17px; font-weight:700">{{comment.added_by.username}}</a>
                        <span>{{ comment.text }}</span>
                        {% if comment.id in comment_ids %}
                            <span class="glyphicon glyphicon-heart pull-right" style="margin-right: 6px;color:#333"></span>
                        {% else %}
                        <form method="post" class="pull-right" action="">{% csrf_token %}
                            <button type="submit" class="btn-link"><span class="glyphicon glyphicon-heart-empty" style="color:#333"></span></button>
                        </form>
                        {% endif %}

                        <p><small class="text-muted"><span style="letter-spacing:-2px">{{ comment.date_added|timesince|stringformat:".3s"|cut:" " }}</span> {% if comment.heart_set.all.count > 0 %}<span class="small-space">{{comment.heart_set.all.count}} hearts</span>{% endif %} {% if comment.reply_set.all.count > 0 %}<span class="small-space">{{comment.reply_set.all.count}} replies</span>{% endif %}<a onclick="reply({{comment.id}})" class="small-space text-muted">Reply</a></small></p>
                        <div style="padding-left: 30px; margin-top: -20px;"><hr>
                            {% for reply in comment.reply_set.all %}
                            <p  style="margin-bottom: 10px;"><a href="{% url 'accounts:profile' pk=comment.added_by.id %}">{{reply.added_by.username}}</a> {{ reply.text }}</p>
                            {% endfor %}
                            <form class="form-inline" id="comment{{comment.id}}" method="post" action="{% url 'videos:create_reply' pk=comment.pk %}" hidden>{% csrf_token %}
                                <div class="form-group"><input type="text" name="text" class="form-control" id="reply{{comment.id}}" placeholder="reply"><button type="submit" class="btn btn-default">reply</button></div>
                            </form>
                        </div>
                    </div>
                    <hr>
                {% endfor %}
            </div><!--/.col-xs-6.col-lg-4-->
            <div class="col-xs-6 col-lg-4">
                <h2>Clamoring</h2>
                <p>Donec id elit non mi porta gravida at eget metus. Fusce  odio dui. </p>
                <p><a class="btn btn-default" href="#" role="button">View details »</a></p>

                <h2>Wheelie</h2>
                <p>Band a dadang id elit non mi porta  commodo, tortor mauris condimentum nibh, ut fermentum massa justo sit amet risus. Etiam porta sem malesuada magna mollis euismod. Donec sed odio dui. </p>
                <p><a class="btn btn-default" href="#" role="button">View details »</a></p>
            </div><!--/.col-xs-6.col-lg-4-->
        </div><!--/row-->
    </div><!--/.col-xs-12.col-sm-9-->

    <div class="col-xs-6 col-sm-3 sidebar-offcanvas" id="sidebar">
        <div class="list-group">
            <h5>Related videos</h5>
            <a href="" class="list-group-item">The martian 2014</a>
            <a href="" class="list-group-item">Captain America</a>
            {% for video_playlist in video.playlist.video_set.all %}
            <a href="{% url 'videos:detail' video_playlist.id %}" class="list-group-item {% if video == video_playlist %} {{ 'active' }} {% endif %}">{{ video_playlist.name }}</a>
            {% endfor %}
        </div>
        <div class="list-group">
            <h5>Categories</h5>
            <a href="" class="list-group-item"><span class="badge">781</span>Robot movies</a>
            <a href="" class="list-group-item"><span class="badge">32</span>Nigerian movies</a>
            {% for category in categories %}
            <a href="{% url 'categories:detail' category.id %}" class="list-group-item {% if video.category == category %} {{ 'active' }} {% endif %}">
                <span class="badge">{{ category.video_set.all.count }} </span>
                {{ category.name }}
            </a>
            {% endfor %}
        </div>
    </div><!--/.sidebar-offcanvas-->
</div><!--/row-->
{% endblock %}